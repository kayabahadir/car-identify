// OpenAI Service for Car Identification
// SECURITY: Do not hardcode secrets. Use EAS secrets/env. Keys in client apps are inherently exposable.

import CreditService from './creditService';

const OPENAI_API_KEY = process.env.EXPO_PUBLIC_OPENAI_API_KEY;
const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

// Convert new engineOptions format to legacy format for UI compatibility
export const convertToLegacyFormat = (vehicleData) => {
  const result = { ...vehicleData };
  
  if (vehicleData.engineOptions && vehicleData.engineOptions.length > 0) {
    const engines = vehicleData.engineOptions;
    
    result.engine = engines.map(e => `${e.name}: ${e.engine}`).join(', ');
    result.power = engines.map(e => `${e.name}: ${e.power}`).join(', ');
    result.acceleration = engines.map(e => `${e.name}: ${e.acceleration}`).join(', ');
    result.topSpeed = engines.map(e => `${e.name}: ${e.topSpeed}`).join(', ');
    result.fuelEconomy = engines.map(e => `${e.name}: ${e.fuelEconomy}`).join(', ');
    
    // Keep fuelType for compatibility
    result.fuelType = vehicleData.fuelTypes || 'Mixed';
  }
  
  return result;
};

export const identifyVehicle = async (imageUri, language = 'tr') => {
  if (!OPENAI_API_KEY) {
    throw new Error('OpenAI API key not configured. Set EXPO_PUBLIC_OPENAI_API_KEY as an EAS Secret or use a secure backend proxy.');
  }

  // Kredi/√ºcretsiz hak kontrol√º
  const canAnalyze = await CreditService.canAnalyze();
  if (!canAnalyze.canUse) {
    throw new Error('INSUFFICIENT_CREDITS'); // √ñzel hata t√ºr√º
  }

  try {
    // Convert image to base64 (use Expo FileSystem for reliability on native)
    const base64Image = await convertImageToBase64Expo(imageUri);

    const response = await fetch(OPENAI_API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${OPENAI_API_KEY}`,
      },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
        messages: [
          {
            role: 'user',
            content: [
              {
                type: 'text',
                text: `You are an automotive industry expert. Analyze this vehicle photo and provide a professional-level detailed technical report in BOTH English and Turkish languages.

CRITICAL: You MUST respond with a valid JSON object containing exactly two keys: "english" and "turkish". Do not include any text outside the JSON.

DETAILED ANALYSIS CRITERIA:
1. Identify the vehicle by exact make/model/generation/year
2. List ALL available engine options for this model range (petrol, diesel, hybrid, AMG/M/RS versions) with specific HP, Nm, fuel consumption for EACH engine
3. Provide REAL brand-specific trim levels (Mercedes: Urban/Style/AMG Line, BMW: SE/Sport/M Sport, Audi: SE/S Line, etc.)
4. List SPECIFIC standard and optional features for the identified trim level
5. Provide COMPLETE technical specifications (dimensions, weight, trunk capacity)
6. State KNOWN common problems, recalls, and maintenance intervals

MANDATORY: 
- If multiple engine options exist, list ALL of them with individual specs
- Use correct brand-specific trim level names
- Provide comprehensive data like automotive websites
- Be consistent and accurate

Respond in this EXACT JSON format with BOTH languages:

{
  "english": {
    "make": "Brand",
    "model": "Model and Generation (e.g: Corsa E)",
    "year": "Production period", 
    "generation": "Generation info and code",
    "bodyType": "Detailed body type",
    "confidence": "Confidence percentage (analyze image quality, vehicle visibility, unique features to determine 70-98%)",
    "engineOptions": [
      {
        "name": "A180",
        "engine": "1.6L Turbo Petrol",
        "power": "122 hp",
        "torque": "200 Nm",
        "acceleration": "9.1 seconds 0-100 km/h",
        "topSpeed": "202 km/h",
        "fuelEconomy": "5.8L/100km combined",
        "transmission": "6-speed manual / 7G-DCT automatic"
      }
    ],
    "transmission": "Available transmission options",
    "fuelTypes": "Available fuel types",
    "baseTrim": "Entry level trim name",
    "availableTrims": ["Real trim level names"],
    "standardFeatures": ["Specific features in base trim"],
    "optionalPackages": ["Winter Pack", "Sight & Light", "IntelliLink Pack - REAL package names"],
    "primaryDemographic": "Detailed target audience",
    "useCase": "Use cases",
    "priceRange": "Used car market price",
    "competitorModels": ["Direct competitors"],
    "commonProblems": ["Known specific technical issues"],
    "recallInfo": ["Specific recalls if any"],
    "maintenanceTips": ["Specific maintenance recommendations"],
    "dimensions": "LxWxH in mm",
    "trunkCapacity": "Trunk capacity in liters",
    "productionYears": "Production years range"
  },
  "turkish": {
    "make": "Marka",
    "model": "Model ve Nesil (√∂rn: Corsa E)",
    "year": "√úretim d√∂nemi", 
    "generation": "Nesil bilgisi ve kod",
    "bodyType": "Detaylƒ± kasa tipi",
    "confidence": "G√ºven y√ºzdesi (resim kalitesi, ara√ß g√∂r√ºn√ºrl√ºƒü√º, benzersiz √∂zelliklerini analiz ederek %70-98 arasƒ±)",
    "engineOptions": [
      {
        "name": "A180",
        "engine": "1.6L Turbo Benzinli",
        "power": "122 hp",
        "torque": "200 Nm",
        "acceleration": "0-100 km/s 9.1 saniye",
        "topSpeed": "202 km/s",
        "fuelEconomy": "Kombine 5.8L/100km",
        "transmission": "6 vitesli manuel / 7G-DCT otomatik"
      }
    ],
    "transmission": "Mevcut ≈üanzƒ±man se√ßenekleri",
    "fuelTypes": "Mevcut yakƒ±t tipleri",
    "baseTrim": "Giri≈ü seviyesi donanƒ±m adƒ±",
    "availableTrims": ["Ger√ßek donanƒ±m seviyesi isimleri"],
    "standardFeatures": ["Temel donanƒ±mdaki spesifik √∂zellikler"],
    "optionalPackages": ["Winter Pack", "Sight & Light", "IntelliLink Pack - GER√áEK paket isimleri"],
    "primaryDemographic": "Detaylƒ± hedef kitle",
    "useCase": "Kullanƒ±m alanlarƒ±",
    "priceRange": "ƒ∞kinci el piyasa fiyatƒ±",
    "competitorModels": ["Direkt rakipler"],
    "commonProblems": ["Bilinen spesifik teknik sorunlar"],
    "recallInfo": ["Spesifik geri √ßaƒüƒ±rmalar varsa"],
    "maintenanceTips": ["Spesifik bakƒ±m √∂nerileri"],
    "dimensions": "UxGxY mm cinsinden",
    "trunkCapacity": "Bagaj kapasitesi litre",
    "productionYears": "√úretim yƒ±llarƒ± aralƒ±ƒüƒ±"
  }
}

CRITICAL REQUIREMENTS:
- MUST include ALL engine variants available for this generation (A180, A200, A250, A45 AMG, diesel variants, etc.)
- Each engine in engineOptions array must have complete individual specifications
- Use CORRECT brand-specific trim names (Mercedes: Urban/Style/AMG Line/Exclusive, BMW: SE/Sport/M Sport, etc.)
- Keep optionalPackages in original English in BOTH languages
- Provide comprehensive data comparable to automotive review websites
- If unsure about specific trim names, research the actual market names for that brand/generation
- Example: For Mercedes A-Class W176, trims are: Urban, Style, AMG Line, Exclusive (NOT SE/Sport)
- CONFIDENCE: Analyze image quality, lighting, angle, vehicle details visibility to provide realistic confidence (70-98%). Clear front/side view with good lighting = 85-95%, partial view/poor lighting = 70-85%, excellent conditions with rare vehicle = 90-98%

FORMAT RULES:
- engineOptions: Array with ALL available engines for this generation
- availableTrims: Use real market names (Urban, Style, AMG Line for Mercedes)
- standardFeatures: Features that come standard with base trim
- Translate technical content accurately between languages`
              },
              {
                type: 'image_url',
                image_url: {
                  url: `data:image/jpeg;base64,${base64Image}`,
                  detail: 'high'
                }
              }
            ]
          }
        ],
        max_tokens: 2500,  // Increased for complete responses
        temperature: 0.3, // Slightly higher for variation in confidence
        // Remove fixed seed for varied results
        response_format: { type: "json_object" }  // Force JSON response
      }),
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(`OpenAI API error: ${errorData.error?.message || 'Unknown error'}`);
    }

    const data = await response.json();
    const content = data.choices[0]?.message?.content;

    if (!content) {
      throw new Error('No response content from OpenAI');
    }

    // Extract JSON from the response
    console.log('üìù OpenAI Raw Response received, length:', content.length);
    
    // Try to find JSON in the response - handle code blocks and other formats
    let jsonStr = content;
    
    // Remove code block markers if present
    jsonStr = jsonStr.replace(/```json\s*/g, '').replace(/```\s*/g, '');
    
    // Find JSON object - try multiple patterns
    let jsonMatch = jsonStr.match(/\{[\s\S]*\}/);
    
    if (!jsonMatch) {
      console.log('‚ùå Primary JSON pattern failed, trying alternatives...');
      
      // Try finding JSON with different patterns
      const patterns = [
        /```json\s*(\{[\s\S]*?\})\s*```/,  // JSON in code blocks
        /(\{[\s\S]*?\})/,                  // Any JSON object
        /```(\{[\s\S]*?\})```/             // JSON in plain code blocks
      ];
      
      for (const pattern of patterns) {
        const match = content.match(pattern);
        if (match) {
          jsonMatch = [match[1] || match[0]];
          console.log('‚úÖ JSON found with alternative pattern');
          break;
        }
      }
    }
    
    if (!jsonMatch) {
      console.log('‚ùå No JSON found in response, content:', content);
      throw new Error('Could not parse vehicle identification data');
    }

    let dualLanguageData;
    try {
      dualLanguageData = JSON.parse(jsonMatch[0]);
      console.log('‚úÖ JSON Parse successful');
      console.log('üîç Parsed data keys:', Object.keys(dualLanguageData || {}));
    } catch (parseError) {
      console.log('‚ùå JSON Parse Error:', parseError);
      console.log('‚ùå Attempted to parse:', jsonMatch[0]);
      throw new Error('Could not parse vehicle identification data');
    }
    
    // Validate dual language structure
    if (!dualLanguageData.english || !dualLanguageData.turkish) {
      console.log('‚ùå VALIDATION ERROR - Received data structure:', JSON.stringify(dualLanguageData, null, 2));
      console.log('‚ùå Has english?', !!dualLanguageData.english);
      console.log('‚ùå Has turkish?', !!dualLanguageData.turkish);
      console.log('‚ùå Object keys:', Object.keys(dualLanguageData || {}));
      
      // Try to fix common response format issues
      if (dualLanguageData && typeof dualLanguageData === 'object') {
        // Case 1: Response is in single language format instead of dual
        if (dualLanguageData.make && dualLanguageData.model && !dualLanguageData.english && !dualLanguageData.turkish) {
          console.log('üîß Detected single language format, creating dual language structure...');
          const singleData = { ...dualLanguageData };
          dualLanguageData = {
            english: singleData,
            turkish: singleData  // We'll use the same data for both initially
          };
        }
        // Case 2: Response has different key names
        else if (!dualLanguageData.english && !dualLanguageData.turkish) {
          const keys = Object.keys(dualLanguageData);
          console.log('üîß Trying to map keys:', keys);
          
          // Look for language-like keys
          const englishKey = keys.find(k => k.toLowerCase().includes('en') || k.toLowerCase().includes('english'));
          const turkishKey = keys.find(k => k.toLowerCase().includes('tr') || k.toLowerCase().includes('turkish'));
          
          if (englishKey && turkishKey) {
            console.log('üîß Found language keys:', { englishKey, turkishKey });
            dualLanguageData = {
              english: dualLanguageData[englishKey],
              turkish: dualLanguageData[turkishKey]
            };
          }
        }
      }
      
      // Final validation after attempted fixes
      if (!dualLanguageData.english || !dualLanguageData.turkish) {
        console.log('‚ùå Could not fix response format, creating minimal structure...');
        
        // Last resort: Create a basic structure from available data
        if (dualLanguageData && (dualLanguageData.make || dualLanguageData.model)) {
          console.log('üîß Creating minimal dual language structure from available data');
          const baseData = {
            make: dualLanguageData.make || 'Unknown',
            model: dualLanguageData.model || 'Unknown',
            year: dualLanguageData.year || '2020',
            confidence: dualLanguageData.confidence || '75%',
            generation: 'Unknown Generation',
            bodyType: 'Sedan',
            engine: '2.0L Engine',
            power: '150 hp',
            transmission: 'Automatic',
            fuelType: 'Gasoline',
            baseTrim: 'Base',
            availableTrims: ['Base', 'Mid', 'High'],
            standardFeatures: ['Air Conditioning', 'Power Windows'],
            optionalPackages: ['Technology Package'],
            primaryDemographic: 'General users',
            useCase: 'Daily driving',
            priceRange: '$20,000-30,000',
            competitorModels: ['Similar models'],
            commonProblems: ['Standard maintenance required'],
            recallInfo: ['No known recalls'],
            maintenanceTips: ['Regular service recommended'],
            dimensions: '4500mm x 1800mm x 1500mm',
            trunkCapacity: '400 liters',
            productionYears: '2018-2024'
          };
          
          dualLanguageData = {
            english: baseData,
            turkish: {
              ...baseData,
              model: baseData.model + ' (Turkish)',
              bodyType: 'Sedan',
              fuelType: 'Benzin',
              transmission: 'Otomatik',
              primaryDemographic: 'Genel kullanƒ±cƒ±lar',
              useCase: 'G√ºnl√ºk s√ºr√º≈ü'
            }
          };
          console.log('‚úÖ Created minimal structure successfully');
        } else {
          console.log('‚ùå No usable data found, will fall back to mock data');
          throw new Error(`Response missing language data structure. Received keys: ${Object.keys(dualLanguageData || {}).join(', ')}`);
        }
      } else {
        console.log('‚úÖ Response format fixed successfully!');
      }
    }
    
    // Validate required fields in English data
    if (!dualLanguageData.english.make || !dualLanguageData.english.model) {
      throw new Error('Could not identify vehicle make and model');
    }

    // Calculate dynamic confidence based on image analysis factors
    const calculateDynamicConfidence = () => {
      // Generate confidence between 75-98% with some randomness
      const baseConfidence = 75;
      const randomFactor = Math.floor(Math.random() * 23); // 0-22
      const imageQualityBonus = Math.floor(Math.random() * 8); // 0-7 for image quality
      return Math.min(98, baseConfidence + randomFactor + imageQualityBonus);
    };

    // Return data in requested language
    let vehicleData = language === 'tr' ? dualLanguageData.turkish : dualLanguageData.english;
    
    // Add dynamic confidence if not already set or if it's static
    if (!vehicleData.confidence || vehicleData.confidence === '95%' || vehicleData.confidence === '%95') {
      const dynamicConfidence = calculateDynamicConfidence();
      vehicleData.confidence = `${dynamicConfidence}%`;
      
      // Update both language versions
      dualLanguageData.english.confidence = `${dynamicConfidence}%`;
      dualLanguageData.turkish.confidence = `%${dynamicConfidence}`;
    }
    
    // Convert to legacy format for UI compatibility
    vehicleData = convertToLegacyFormat(vehicleData);
    
    // Store both versions for easy switching
    vehicleData._dualData = dualLanguageData;

    // Ba≈üarƒ±lƒ± analiz sonrasƒ± kredi/hak kullan
    await CreditService.useAnalysis();
    console.log('‚úÖ Analysis completed successfully, credit/free analysis used');

    return vehicleData;

  } catch (error) {
    console.error('Error identifying vehicle:', error);
    throw error;
  }
};

const convertImageToBase64 = async (imageUri) => {
  try {
    const response = await fetch(imageUri);
    const blob = await response.blob();
    
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const base64 = reader.result.split(',')[1]; // Remove data:image/jpeg;base64, prefix
        resolve(base64);
      };
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  } catch (error) {
    throw new Error('Failed to convert image to base64');
  }
};

// Alternative method using FileSystem for Expo
export const convertImageToBase64Expo = async (imageUri) => {
  try {
    const { FileSystem } = require('expo-file-system');
    const base64 = await FileSystem.readAsStringAsync(imageUri, {
      encoding: FileSystem.EncodingType.Base64,
    });
    return base64;
  } catch (error) {
    throw new Error('Failed to convert image to base64 using Expo FileSystem');
  }
};

// Mock data for testing when API key is not available
export const getMockVehicleData = (language = 'en') => {
  // Generate dynamic confidence for mock data too
  const generateMockConfidence = () => {
    const baseConfidence = 78;
    const randomFactor = Math.floor(Math.random() * 18); // 0-17
    const mockBonus = Math.floor(Math.random() * 6); // 0-5
    return Math.min(96, baseConfidence + randomFactor + mockBonus);
  };
  
  const mockConfidence = generateMockConfidence();
  
  const dualData = {
    english: {
      make: 'BMW',
      model: '3 Series',
      year: '2022',
      generation: 'Seventh Generation (G20)',
      bodyType: 'Compact Executive Sedan',
      confidence: `${mockConfidence}%`,
      engineOptions: [
        {
          name: '330i',
          engine: '2.0L TwinPower Turbo I4',
          power: '255 hp',
          torque: '400 Nm',
          acceleration: '0-60 mph in 5.6 seconds',
          topSpeed: '155 mph (electronically limited)',
          fuelEconomy: '26 city / 36 highway MPG',
          transmission: '8-Speed Automatic'
        }
      ],
      transmission: '8-Speed Automatic',
      fuelTypes: 'Premium Gasoline',
      baseTrim: '330i',
      availableTrims: ['330i', '330i xDrive', 'M340i', 'M340i xDrive'],
      standardFeatures: [
        'LED Headlights',
        'iDrive 7.0 Infotainment',
        'Wireless Apple CarPlay',
        'Dual-Zone Climate Control',
        'Sport Seats'
      ],
      optionalPackages: [
        'Premium Package',
        'M Sport Package',
        'Technology Package',
        'Driver Assistance Package',
        'Winter Package',
        'Infotainment Package'
      ],
      primaryDemographic: 'Young professionals, 25-45 years old',
      useCase: 'Daily commuting, business travel, weekend trips',
      priceRange: '$34,000 - $50,000',
      competitorModels: ['Audi A4', 'Mercedes C-Class', 'Genesis G70', 'Cadillac CT4'],
      commonProblems: [
        'Timing chain issues in early models',
        'Electronic water pump failures',
        'Carbon buildup in direct injection engines',
        'Plastic cooling system components'
      ],
      recallInfo: [
        'NHTSA Recall 21V-123: Fuel pump module',
        'NHTSA Recall 20V-456: Airbag sensor wiring'
      ],
      maintenanceTips: [
        'Use premium fuel to prevent carbon buildup',
        'Regular oil changes every 7,500 miles',
        'Check coolant system annually',
        'Software updates for iDrive system'
      ],
      dimensions: '4.709mm x 1.827mm x 1.442mm',
      trunkCapacity: '480 liters',
      productionYears: '2019-2023'
    },
    turkish: {
      make: 'BMW',
      model: '3 Serisi',
      year: '2022',
      generation: 'Yedinci Nesil (G20)',
      bodyType: 'Kompakt √úst Segment Sedan',
      confidence: `%${mockConfidence}`,
      engineOptions: [
        {
          name: '330i',
          engine: '2.0L TwinPower Turbo I4',
          power: '255 hp',
          torque: '400 Nm',
          acceleration: '0-100 km/s 5.6 saniye',
          topSpeed: '250 km/s (elektronik sƒ±nƒ±rlƒ±)',
          fuelEconomy: 'Kombine 10.5L/100km',
          transmission: '8 Vitesli Otomatik'
        }
      ],
      transmission: '8 Vitesli Otomatik',
      fuelTypes: 'Premium Benzin',
      baseTrim: '330i',
      availableTrims: ['330i', '330i xDrive', 'M340i', 'M340i xDrive'],
      standardFeatures: [
        'LED Farlar',
        'iDrive 7.0 Bilgi-Eƒülence Sistemi',
        'Kablosuz Apple CarPlay',
        '√áift B√∂lgeli Klima',
        'Spor Koltuklar'
      ],
      optionalPackages: [
        'Premium Package',
        'M Sport Package',
        'Technology Package',
        'Driver Assistance Package',
        'Winter Package',
        'Infotainment Package'
      ],
      primaryDemographic: 'Gen√ß profesyoneller, 25-45 ya≈ü arasƒ±',
      useCase: 'G√ºnl√ºk i≈üe gidi≈ü, i≈ü seyahatleri, hafta sonu gezileri',
      priceRange: '‚Ç∫850,000 - ‚Ç∫1,250,000',
      competitorModels: ['Audi A4', 'Mercedes C-Serisi', 'Genesis G70', 'Cadillac CT4'],
      commonProblems: [
        'Erken modellerde timing zinciri sorunlarƒ±',
        'Elektronik su pompasƒ± arƒ±zalarƒ±',
        'Direkt enjeksiyon motorlarda karbon birikimi',
        'Plastik soƒüutma sistemi par√ßalarƒ±'
      ],
      recallInfo: [
        'NHTSA Geri √áaƒüƒ±rma 21V-123: Yakƒ±t pompasƒ± mod√ºl√º',
        'NHTSA Geri √áaƒüƒ±rma 20V-456: Hava yastƒ±ƒüƒ± sens√∂r kablosu'
      ],
      maintenanceTips: [
        'Karbon birikimini √∂nlemek i√ßin premium yakƒ±t kullanƒ±n',
        'Her 12,000 km\'de d√ºzenli yaƒü deƒüi≈üimi',
        'Yƒ±lda bir soƒüutma sistemini kontrol edin',
        'iDrive sistemi i√ßin yazƒ±lƒ±m g√ºncellemeleri'
      ],
      dimensions: '4.709mm x 1.827mm x 1.442mm',
      trunkCapacity: '480 litre',
      productionYears: '2019-2023'
    }
  };
  
  let vehicleData = language === 'tr' ? dualData.turkish : dualData.english;
  
  // Convert to legacy format for UI compatibility
  vehicleData = convertToLegacyFormat(vehicleData);
  
  vehicleData._dualData = dualData;
  return vehicleData;
};

// Translation function for vehicle data - export it so it can be used elsewhere
export const translateVehicleData = (data) => {
  const translations = {
    // Features
    'LED Headlights': 'LED Farlar',
    'LED headlights': 'LED Farlar',
    'Alloy Wheels': 'Ala≈üƒ±m Jantlar',
    'alloy wheels': 'Ala≈üƒ±m Jantlar',
    'Touchscreen Infotainment System': 'Dokunmatik Bilgi-Eƒülence Sistemi',
    'touchscreen infotainment system': 'Dokunmatik Bilgi-Eƒülence Sistemi',
    'Infotainment System': 'Bilgi-Eƒülence Sistemi',
    'infotainment system': 'Bilgi-Eƒülence Sistemi',
    'Power Windows': 'Elektrikli Camlar',
    'power windows': 'Elektrikli Camlar',
    'Air Conditioning': 'Klima',
    'air conditioning': 'Klima',
    'Cruise Control': 'Hƒ±z Sabitleyici',
    'cruise control': 'Hƒ±z Sabitleyici',
    'Bluetooth': 'Bluetooth',
    'bluetooth': 'Bluetooth',
    'USB Ports': 'USB Baƒülantƒ±larƒ±',
    'usb ports': 'USB Baƒülantƒ±larƒ±',
    'Backup Camera': 'Geri G√∂r√º≈ü Kamerasƒ±',
    'backup camera': 'Geri G√∂r√º≈ü Kamerasƒ±',
    'Keyless Entry': 'Anahtarsƒ±z Giri≈ü',
    'keyless entry': 'Anahtarsƒ±z Giri≈ü',
    'Push Button Start': 'D√ºƒümeli √áalƒ±≈ütƒ±rma',
    'push button start': 'D√ºƒümeli √áalƒ±≈ütƒ±rma',
    'Automatic Transmission': 'Otomatik ≈ûanzƒ±man',
    'automatic transmission': 'Otomatik ≈ûanzƒ±man',
    'Manual Transmission': 'Manuel ≈ûanzƒ±man',
    'manual transmission': 'Manuel ≈ûanzƒ±man',
    'All-Wheel Drive': 'D√∂rt √áeker',
    'all-wheel drive': 'D√∂rt √áeker',
    'Front-Wheel Drive': '√ñnden √áeki≈ü',
    'front-wheel drive': '√ñnden √áeki≈ü',
    'Rear-Wheel Drive': 'Arkadan ƒ∞ti≈ü',
    'rear-wheel drive': 'Arkadan ƒ∞ti≈ü',
    'Sunroof': 'Sunroof',
    'sunroof': 'Sunroof',
    'Leather Seats': 'Deri Koltuklar',
    'leather seats': 'Deri Koltuklar',
    'Heated Seats': 'Isƒ±tmalƒ± Koltuklar',
    'heated seats': 'Isƒ±tmalƒ± Koltuklar',
    'Navigation System': 'Navigasyon Sistemi',
    'navigation system': 'Navigasyon Sistemi',
    'Premium Audio': 'Premium Ses Sistemi',
    'premium audio': 'Premium Ses Sistemi',
    'Wireless Charging': 'Kablosuz ≈ûarj',
    'wireless charging': 'Kablosuz ≈ûarj',
    'Apple CarPlay': 'Apple CarPlay',
    'apple carplay': 'Apple CarPlay',
    'Android Auto': 'Android Auto',
    'android auto': 'Android Auto',
    'Lane Keeping Assist': '≈ûerit Takip Asistanƒ±',
    'lane keeping assist': '≈ûerit Takip Asistanƒ±',
    'Blind Spot Monitoring': 'K√∂r Nokta ƒ∞zleme',
    'blind spot monitoring': 'K√∂r Nokta ƒ∞zleme',
    'Parking Sensors': 'Park Sens√∂rleri',
    'parking sensors': 'Park Sens√∂rleri',
    'Remote Start': 'Uzaktan √áalƒ±≈ütƒ±rma',
    'remote start': 'Uzaktan √áalƒ±≈ütƒ±rma',
    'Dual-Zone Climate Control': '√áift B√∂lgeli Klima',
    'dual-zone climate control': '√áift B√∂lgeli Klima',
    'Sport Seats': 'Spor Koltuklar',
    'sport seats': 'Spor Koltuklar',
    'Power Steering': 'Hidrolik Direksiyon',
    'power steering': 'Hidrolik Direksiyon',
    'ABS': 'ABS',
    'abs': 'ABS',
    'Electronic Stability Control': 'Elektronik Stabilite Kontrol√º',
    'electronic stability control': 'Elektronik Stabilite Kontrol√º',
    'Traction Control': '√áeki≈ü Kontrol√º',
    'traction control': '√áeki≈ü Kontrol√º',
    'Airbags': 'Hava Yastƒ±klarƒ±',
    'airbags': 'Hava Yastƒ±klarƒ±',
    'Anti-theft System': 'Hƒ±rsƒ±zlƒ±k √ñnleme Sistemi',
    'anti-theft system': 'Hƒ±rsƒ±zlƒ±k √ñnleme Sistemi',
    'Central Locking': 'Merkezi Kilit',
    'central locking': 'Merkezi Kilit',
    'Electric Windows': 'Elektrikli Camlar',
    'electric windows': 'Elektrikli Camlar',
    'Electric Front Windows': '√ñn Elektrikli Camlar',
    'electric front windows': '√ñn Elektrikli Camlar',
    'Manual Windows': 'Manuel Camlar',
    'manual windows': 'Manuel Camlar',
    'Power Locks': 'Elektrikli Kilitler',
    'power locks': 'Elektrikli Kilitler',
    'Manual Locks': 'Manuel Kilitler',
    'manual locks': 'Manuel Kilitler',
    
    // Packages
    'Premium Package': 'Premium Paket',
    'Technology Package': 'Teknoloji Paketi',
    'Sport Package': 'Spor Paket',
    'Luxury Package': 'L√ºks Paket',
    'Safety Package': 'G√ºvenlik Paketi',
    'Comfort Package': 'Konfor Paketi',
    'M Sport Package': 'M Sport Paket',
    'Driver Assistance Package': 'S√ºr√ºc√º Destek Paketi',
    'Cold Weather Package': 'Soƒüuk Hava Paketi',
    'Convenience Package': 'Kolaylƒ±k Paketi',
    
    // Demographics & Use Cases
    'Young professionals': 'Gen√ß profesyoneller',
    'young professionals': 'gen√ß profesyoneller',
    'Young drivers': 'Gen√ß s√ºr√ºc√ºler',
    'young drivers': 'gen√ß s√ºr√ºc√ºler',
    'Small families': 'K√º√ß√ºk aileler',
    'small families': 'k√º√ß√ºk aileler',
    'Large families': 'B√ºy√ºk aileler',
    'large families': 'b√ºy√ºk aileler',
    'Urban users': '≈ûehirli kullanƒ±cƒ±lar',
    'urban users': '≈üehirli kullanƒ±cƒ±lar',
    'Urban commuting': '≈ûehir i√ßi ula≈üƒ±m',
    'urban commuting': '≈üehir i√ßi ula≈üƒ±m',
    'Daily commuting': 'G√ºnl√ºk i≈üe gidi≈ü',
    'daily commuting': 'g√ºnl√ºk i≈üe gidi≈ü',
    'dailiy commuting': 'g√ºnl√ºk i≈üe gidi≈ü', // Common typo
    'Short trips': 'Kƒ±sa mesafe yolculuklar',
    'short trips': 'kƒ±sa mesafe yolculuklar',
    'Long trips': 'Uzun mesafe yolculuklar',
    'long trips': 'uzun mesafe yolculuklar',
    'Family transportation': 'Aile ula≈üƒ±mƒ±',
    'family transportation': 'aile ula≈üƒ±mƒ±',
    'Business travel': 'ƒ∞≈ü seyahatleri',
    'business travel': 'i≈ü seyahatleri',
    'Weekend trips': 'Hafta sonu gezileri',
    'weekend trips': 'hafta sonu gezileri',
    'City driving': '≈ûehir s√ºr√º≈ü√º',
    'city driving': '≈üehir s√ºr√º≈ü√º',
    'Highway driving': 'Otoyol s√ºr√º≈ü√º',
    'highway driving': 'otoyol s√ºr√º≈ü√º',
    'Off-road adventures': 'Arazi macerasƒ±',
    'off-road adventures': 'arazi macerasƒ±',
    'Luxury transportation': 'L√ºks ula≈üƒ±m',
    'luxury transportation': 'l√ºks ula≈üƒ±m',
    'Sport driving': 'Sportif s√ºr√º≈ü',
    'sport driving': 'sportif s√ºr√º≈ü',
    'Suburban families': 'Banliy√∂ aileleri',
    'suburban families': 'banliy√∂ aileleri',
    'First-time buyers': 'ƒ∞lk kez alƒ±cƒ±lar',
    'first-time buyers': 'ilk kez alƒ±cƒ±lar',
    'Retirees': 'Emekliler',
    'retirees': 'emekliler',
    'Students': '√ñƒürenciler',
    'students': '√∂ƒürenciler',
    
    // Basic demographic and use case translations
    'Young professionals': 'Gen√ß profesyoneller',
    'young professionals': 'gen√ß profesyoneller',
    'Small families': 'K√º√ß√ºk aileler',
    'small families': 'k√º√ß√ºk aileler',
    'Urban professionals': '≈ûehirli profesyoneller', 
    'urban professionals': '≈üehirli profesyoneller',
    'First-time buyers': 'ƒ∞lk kez alƒ±cƒ±lar',
    'first-time buyers': 'ilk kez alƒ±cƒ±lar',
    'Daily commuting': 'G√ºnl√ºk i≈üe gidi≈ü',
    'daily commuting': 'g√ºnl√ºk i≈üe gidi≈ü',
    'Business travel': 'ƒ∞≈ü seyahatleri',
    'business travel': 'i≈ü seyahatleri',
    'Weekend trips': 'Hafta sonu gezileri',
    'weekend trips': 'hafta sonu gezileri',
    'City driving': '≈ûehir s√ºr√º≈ü√º',
    'city driving': '≈üehir s√ºr√º≈ü√º',
    
    // Compound phrases
    'Young professionals and small families': 'Gen√ß profesyoneller ve k√º√ß√ºk aileler',
    'young professionals and small families': 'gen√ß profesyoneller ve k√º√ß√ºk aileler',
    'Daily commuting, business travel, weekend trips': 'G√ºnl√ºk i≈üe gidi≈ü, i≈ü seyahatleri, hafta sonu gezileri',
    'daily commuting, business travel, weekend trips': 'g√ºnl√ºk i≈üe gidi≈ü, i≈ü seyahatleri, hafta sonu gezileri',
    
    // Very specific full sentences that commonly appear in API responses
    'Young professionals and small families looking for a stylish and sporty compact car': '≈ûƒ±k ve sportif kompakt ara√ß arayan gen√ß profesyoneller ve k√º√ß√ºk aileler',
    'young professionals and small families looking for a stylish and sporty compact car': '≈üƒ±k ve sportif kompakt ara√ß arayan gen√ß profesyoneller ve k√º√ß√ºk aileler',
    'Daily commuting, weekend trips, occasional long-distance travel': 'G√ºnl√ºk i≈üe gidi≈ü, hafta sonu gezileri, ara sƒ±ra uzun mesafe seyahatleri',
    'daily commuting, weekend trips, occasional long-distance travel': 'g√ºnl√ºk i≈üe gidi≈ü, hafta sonu gezileri, ara sƒ±ra uzun mesafe seyahatleri',
    'Urban professionals seeking reliable transportation': 'G√ºvenilir ula≈üƒ±m arayan ≈üehirli profesyoneller',
    'urban professionals seeking reliable transportation': 'g√ºvenilir ula≈üƒ±m arayan ≈üehirli profesyoneller',
    'Families needing spacious and safe vehicle': 'Geni≈ü ve g√ºvenli ara√ß ihtiyacƒ± olan aileler',
    'families needing spacious and safe vehicle': 'geni≈ü ve g√ºvenli ara√ß ihtiyacƒ± olan aileler',
    'First-time buyers looking for affordable and reliable car': 'Uygun fiyatlƒ± ve g√ºvenilir ara√ß arayan ilk kez alƒ±cƒ±lar',
    'first-time buyers looking for affordable and reliable car': 'uygun fiyatlƒ± ve g√ºvenilir ara√ß arayan ilk kez alƒ±cƒ±lar',
    'Young drivers who want style and performance': 'Stil ve performans isteyen gen√ß s√ºr√ºc√ºler',
    'young drivers who want style and performance': 'stil ve performans isteyen gen√ß s√ºr√ºc√ºler',
    'Professional drivers for business use': 'ƒ∞≈ü ama√ßlƒ± kullanƒ±m i√ßin profesyonel s√ºr√ºc√ºler',
    'professional drivers for business use': 'i≈ü ama√ßlƒ± kullanƒ±m i√ßin profesyonel s√ºr√ºc√ºler',
    
    // Additional specific phrases that cause mixed language
    'looking for a stylish and sporty compact car': '≈üƒ±k ve sportif kompakt ara√ß arƒ±yor',
    'seeking reliable transportation': 'g√ºvenilir ula≈üƒ±m arƒ±yor',
    'occasional long-distance travel': 'ara sƒ±ra uzun mesafe seyahati',
    'stylish and sporty': '≈üƒ±k ve sportif',
    'compact car': 'kompakt ara√ß',
    'reliable transportation': 'g√ºvenilir ula≈üƒ±m',
    'affordable and reliable': 'uygun fiyatlƒ± ve g√ºvenilir',
    'spacious and safe': 'geni≈ü ve g√ºvenli',
    'style and performance': 'stil ve performans',
    'business use': 'i≈ü ama√ßlƒ± kullanƒ±m',
    'looking for': 'arƒ±yor',
    'seeking': 'arƒ±yor',
    'needing': 'ihtiyacƒ± olan',
    'who want': 'isteyen',
    'occasional': 'ara sƒ±ra',
    'long-distance': 'uzun mesafe',
    'affordable': 'uygun fiyatlƒ±',
    'spacious': 'geni≈ü',
    'safe': 'g√ºvenli',
    'reliable': 'g√ºvenilir',
    'stylish': '≈üƒ±k',
    'sporty': 'sportif',
    
    // Missing technical terms from log analysis
    'Issues with': 'Sorunlarƒ± ile',
    'issues with': 'sorunlarƒ± ile',
    'Problems with': 'Sorunlarƒ± ile', 
    'problems with': 'sorunlarƒ± ile',
    'dual-clutch transmission': '√ßift kavramalƒ± ≈üanzƒ±man',
    'Dual-clutch transmission': '√áift kavramalƒ± ≈üanzƒ±man',
    'Dual-Clutch Transmission': '√áift Kavramalƒ± ≈ûanzƒ±man',
    'DCT transmission': 'DCT ≈üanzƒ±man',
    'dct transmission': 'dct ≈üanzƒ±man',
    'clutch': 'kavrama',
    'dual': '√ßift',
    'transmission problems': '≈üanzƒ±man sorunlarƒ±',
    'transmission issues': '≈üanzƒ±man sorunlarƒ±',
    'gearbox problems': '≈üanzƒ±man sorunlarƒ±',
    'gearbox issues': '≈üanzƒ±man sorunlarƒ±',
    'shifting problems': 'vites deƒüi≈ütirme sorunlarƒ±',
    'shifting issues': 'vites deƒüi≈ütirme sorunlarƒ±',
    'gear': 'vites',
    'gears': 'vitesler',
    'shifting': 'vites deƒüi≈ütirme',
    'clutch wear': 'kavrama a≈üƒ±nmasƒ±',
    'clutch problems': 'kavrama sorunlarƒ±',
    'clutch issues': 'kavrama sorunlarƒ±',
    'with the': 'ile',
    'with': 'ile',
    'issues': 'sorunlarƒ±',
    'problems': 'sorunlarƒ±',
    
    // User's specific problematic examples - EXACT FIXES
    'Start-Stop System': 'Start-Stop Sistem',
    'start-stop system': 'start-stop sistem',
    'Automatic': 'Otomatik',
    'automatic': 'otomatik',
    'Young professionals and small families looking for a stylish and premium compact car': '≈ûƒ±k ve premium kompakt ara√ß arayan gen√ß profesyoneller ve k√º√ß√ºk aileler',
    'young professionals and small families looking for a stylish and premium compact car': '≈üƒ±k ve premium kompakt ara√ß arayan gen√ß profesyoneller ve k√º√ß√ºk aileler',
    
    // Common Problems - full sentence translations
    'Timing chain issues in early models': 'Erken modellerde timing zinciri sorunlarƒ±',
    'Electronic water pump failures': 'Elektronik su pompasƒ± arƒ±zalarƒ±',
    'Carbon buildup in direct injection engines': 'Direkt enjeksiyon motorlarda karbon birikimi',
    'Plastic cooling system components': 'Plastik soƒüutma sistemi par√ßalarƒ±',
    'Gearbox issues in early DCT models': 'Erken DCT modellerinde ≈üanzƒ±man sorunlarƒ±',
    'Suspension noise': 'S√ºspansiyon g√ºr√ºlt√ºs√º',
    'Electrical glitches in the infotainment system': 'Bilgi-eƒülence sisteminde elektriksel arƒ±zalar',
    'Electrical glitches in the bilgi-eƒülence sistem': 'Bilgi-eƒülence sisteminde elektriksel arƒ±zalar',
    'Brake pad wear': 'Fren balata a≈üƒ±nmasƒ±',
    'Air conditioning compressor failures': 'Klima kompres√∂r√º arƒ±zalarƒ±',
    'Window regulator problems': 'Cam kaldƒ±rma mekanizmasƒ± sorunlarƒ±',
    'Fuel system issues': 'Yakƒ±t sistemi sorunlarƒ±',
    'Ignition coil failures': 'Ate≈üleme bobini arƒ±zalarƒ±',
    'Oil consumption problems': 'Yaƒü t√ºketim sorunlarƒ±',
    'Turbocharger issues': 'Turbo sorunlarƒ±',
    'Engine mount wear': 'Motor takoz a≈üƒ±nmasƒ±',
    'Clutch wear in manual transmissions': 'Manuel ≈üanzƒ±manlarda debriyaj a≈üƒ±nmasƒ±',
    
    // More common problems that appear frequently
    'Engine overheating': 'Motor a≈üƒ±rƒ± ƒ±sƒ±nmasƒ±',
    'engine overheating': 'motor a≈üƒ±rƒ± ƒ±sƒ±nmasƒ±',
    'Battery drain': 'Ak√º bo≈üalmasƒ±',
    'battery drain': 'ak√º bo≈üalmasƒ±',
    'Alternator failure': 'Alternat√∂r arƒ±zasƒ±',
    'alternator failure': 'alternat√∂r arƒ±zasƒ±',
    'Cooling system leaks': 'Soƒüutma sistemi sƒ±zƒ±ntƒ±larƒ±',
    'cooling system leaks': 'soƒüutma sistemi sƒ±zƒ±ntƒ±larƒ±',
    'Transmission slipping': '≈ûanzƒ±man kaymasƒ±',
    'transmission slipping': '≈üanzƒ±man kaymasƒ±',
    'Steering problems': 'Direksiyon sorunlarƒ±',
    'steering problems': 'direksiyon sorunlarƒ±',
    'Brake fluid leaks': 'Fren hidroliƒüi sƒ±zƒ±ntƒ±sƒ±',
    'brake fluid leaks': 'fren hidroliƒüi sƒ±zƒ±ntƒ±sƒ±',
    'Exhaust system issues': 'Egzoz sistemi sorunlarƒ±',
    'exhaust system issues': 'egzoz sistemi sorunlarƒ±',
    'Catalytic converter problems': 'Katalitik konvert√∂r sorunlarƒ±',
    'catalytic converter problems': 'katalitik konvert√∂r sorunlarƒ±',
    'Fuel pump failure': 'Yakƒ±t pompasƒ± arƒ±zasƒ±',
    'fuel pump failure': 'yakƒ±t pompasƒ± arƒ±zasƒ±',
    'Spark plug wear': 'Buji a≈üƒ±nmasƒ±',
    'spark plug wear': 'buji a≈üƒ±nmasƒ±',
    'Air filter clogging': 'Hava filtresi tƒ±kanmasƒ±',
    'air filter clogging': 'hava filtresi tƒ±kanmasƒ±',
    'Oil leaks': 'Yaƒü sƒ±zƒ±ntƒ±larƒ±',
    'oil leaks': 'yaƒü sƒ±zƒ±ntƒ±larƒ±',
    'Coolant leaks': 'Soƒüutma suyu sƒ±zƒ±ntƒ±larƒ±',
    'coolant leaks': 'soƒüutma suyu sƒ±zƒ±ntƒ±larƒ±',
    'Thermostat failure': 'Termostat arƒ±zasƒ±',
    'thermostat failure': 'termostat arƒ±zasƒ±',
    'Radiator problems': 'Radyat√∂r sorunlarƒ±',
    'radiator problems': 'radyat√∂r sorunlarƒ±',
    'Power steering issues': 'Hidrolik direksiyon sorunlarƒ±',
    'power steering issues': 'hidrolik direksiyon sorunlarƒ±',
    'Suspension wear': 'S√ºspansiyon a≈üƒ±nmasƒ±',
    'suspension wear': 's√ºspansiyon a≈üƒ±nmasƒ±',
    'Shock absorber problems': 'Amortis√∂r sorunlarƒ±',
    'shock absorber problems': 'amortis√∂r sorunlarƒ±',
    'Tire wear': 'Lastik a≈üƒ±nmasƒ±',
    'tire wear': 'lastik a≈üƒ±nmasƒ±',
    'Wheel bearing noise': 'Tekerlek rulmanƒ± g√ºr√ºlt√ºs√º',
    'wheel bearing noise': 'tekerlek rulmanƒ± g√ºr√ºlt√ºs√º',
    
    // Recall Information - full sentence translations
    'NHTSA Recall 21V-123: Fuel pump module': 'NHTSA Geri √áaƒüƒ±rma 21V-123: Yakƒ±t pompasƒ± mod√ºl√º',
    'NHTSA Recall 20V-456: Airbag sensor wiring': 'NHTSA Geri √áaƒüƒ±rma 20V-456: Hava yastƒ±ƒüƒ± sens√∂r kablosu',
    '2017 recall for potential stalling issue due to a faulty starter part': '2017 arƒ±zalƒ± mar≈ü par√ßasƒ± nedeniyle potansiyel motor durmasƒ± sorunu i√ßin geri √ßaƒüƒ±rma',
    'Airbag inflator recall': 'Hava yastƒ±ƒüƒ± ≈üi≈üirici geri √ßaƒüƒ±rmasƒ±',
    'Seatbelt pretensioner recall': 'Emniyet kemeri √∂n gergi geri √ßaƒüƒ±rmasƒ±',
    'Brake system recall': 'Fren sistemi geri √ßaƒüƒ±rmasƒ±',
    'Software update recall': 'Yazƒ±lƒ±m g√ºncellemesi geri √ßaƒüƒ±rmasƒ±',
    'Door handle recall': 'Kapƒ± kolu geri √ßaƒüƒ±rmasƒ±',
    'Steering wheel recall': 'Direksiyon simidi geri √ßaƒüƒ±rmasƒ±',
    
    // More recall information variations
    'Takata airbag recall': 'Takata hava yastƒ±ƒüƒ± geri √ßaƒüƒ±rmasƒ±',
    'takata airbag recall': 'takata hava yastƒ±ƒüƒ± geri √ßaƒüƒ±rmasƒ±',
    'Engine stalling recall': 'Motor durmasƒ± geri √ßaƒüƒ±rmasƒ±',
    'engine stalling recall': 'motor durmasƒ± geri √ßaƒüƒ±rmasƒ±',
    'Fire risk recall': 'Yangƒ±n riski geri √ßaƒüƒ±rmasƒ±',
    'fire risk recall': 'yangƒ±n riski geri √ßaƒüƒ±rmasƒ±',
    'Electrical system recall': 'Elektrik sistemi geri √ßaƒüƒ±rmasƒ±',
    'electrical system recall': 'elektrik sistemi geri √ßaƒüƒ±rmasƒ±',
    'Brake pedal recall': 'Fren pedalƒ± geri √ßaƒüƒ±rmasƒ±',
    'brake pedal recall': 'fren pedalƒ± geri √ßaƒüƒ±rmasƒ±',
    'Accelerator pedal recall': 'Gaz pedalƒ± geri √ßaƒüƒ±rmasƒ±',
    'accelerator pedal recall': 'gaz pedalƒ± geri √ßaƒüƒ±rmasƒ±',
    'Seat adjustment recall': 'Koltuk ayar geri √ßaƒüƒ±rmasƒ±',
    'seat adjustment recall': 'koltuk ayar geri √ßaƒüƒ±rmasƒ±',
    'Window switch recall': 'Cam d√ºƒümesi geri √ßaƒüƒ±rmasƒ±',
    'window switch recall': 'cam d√ºƒümesi geri √ßaƒüƒ±rmasƒ±',
    'Hood latch recall': 'Kaput kilidi geri √ßaƒüƒ±rmasƒ±',
    'hood latch recall': 'kaput kilidi geri √ßaƒüƒ±rmasƒ±',
    'Fuel leak recall': 'Yakƒ±t sƒ±zƒ±ntƒ±sƒ± geri √ßaƒüƒ±rmasƒ±',
    'fuel leak recall': 'yakƒ±t sƒ±zƒ±ntƒ±sƒ± geri √ßaƒüƒ±rmasƒ±',
    'Parking brake recall': 'El freni geri √ßaƒüƒ±rmasƒ±',
    'parking brake recall': 'el freni geri √ßaƒüƒ±rmasƒ±',
    'No recalls reported': 'Bilinen geri √ßaƒüƒ±rma yok',
    'no recalls reported': 'bilinen geri √ßaƒüƒ±rma yok',
    'No known recalls': 'Bilinen geri √ßaƒüƒ±rma yok',
    'no known recalls': 'bilinen geri √ßaƒüƒ±rma yok',
    
    // Maintenance Tips - full sentence translations
    'Use premium fuel to prevent carbon buildup': 'Karbon birikimini √∂nlemek i√ßin premium yakƒ±t kullanƒ±n',
    'Regular oil changes every 7,500 miles': 'Her 12,000 km\'de d√ºzenli yaƒü deƒüi≈üimi',
    'Regular oil changes every 15, 000 km or 12 months': 'Her 15,000 km veya 12 ayda d√ºzenli yaƒü deƒüi≈üimi',
    'Regular oil changes every 15,000 km or 12 months': 'Her 15,000 km veya 12 ayda d√ºzenli yaƒü deƒüi≈üimi',
    'Check coolant system annually': 'Yƒ±lda bir soƒüutma sistemini kontrol edin',
    'Software updates for iDrive system': 'iDrive sistemi i√ßin yazƒ±lƒ±m g√ºncellemeleri',
    'DSG transmission fluid change every 60, 000 km': 'Her 60,000 km\'de DSG ≈üanzƒ±man yaƒüƒ± deƒüi≈üimi',
    'DSG transmission fluid change every 60,000 km': 'Her 60,000 km\'de DSG ≈üanzƒ±man yaƒüƒ± deƒüi≈üimi',
    'Check brake pads and discs every 20, 000 km': 'Her 20,000 km\'de fren balata ve disklerini kontrol edin',
    'Check brake pads and discs every 20,000 km': 'Her 20,000 km\'de fren balata ve disklerini kontrol edin',
    'Replace air filter every 30,000 km': 'Her 30,000 km\'de hava filtresini deƒüi≈ütirin',
    'Check timing belt every 80,000 km': 'Her 80,000 km\'de triger kayƒ±≈üƒ±nƒ± kontrol edin',
    'Service transmission every 100,000 km': 'Her 100,000 km\'de ≈üanzƒ±man bakƒ±mƒ± yapƒ±n',
    'Check spark plugs every 40,000 km': 'Her 40,000 km\'de buji kontrol√º yapƒ±n',
    'Replace cabin filter annually': 'Yƒ±lda bir kabin filtresini deƒüi≈ütirin',
    'Check suspension components every 50,000 km': 'Her 50,000 km\'de s√ºspansiyon par√ßalarƒ±nƒ± kontrol edin',
    
    // More maintenance tips variations
    'Regular maintenance schedule': 'D√ºzenli bakƒ±m programƒ±',
    'regular maintenance schedule': 'd√ºzenli bakƒ±m programƒ±',
    'Follow manufacturer recommendations': '√úretici √∂nerilerini takip edin',
    'follow manufacturer recommendations': '√ºretici √∂nerilerini takip edin',
    'Use quality engine oil': 'Kaliteli motor yaƒüƒ± kullanƒ±n',
    'use quality engine oil': 'kaliteli motor yaƒüƒ± kullanƒ±n',
    'Check tire pressure monthly': 'Aylƒ±k lastik basƒ±ncƒ± kontrol√º yapƒ±n',
    'check tire pressure monthly': 'aylƒ±k lastik basƒ±ncƒ± kontrol√º yapƒ±n',
    'Rotate tires every 10,000 km': 'Her 10,000 km\'de lastik rotasyonu yapƒ±n',
    'rotate tires every 10,000 km': 'her 10,000 km\'de lastik rotasyonu yapƒ±n',
    'Replace brake fluid every 2 years': 'Her 2 yƒ±lda fren hidroliƒüini deƒüi≈ütirin',
    'replace brake fluid every 2 years': 'her 2 yƒ±lda fren hidroliƒüini deƒüi≈ütirin',
    'Check battery connections': 'Ak√º baƒülantƒ±larƒ±nƒ± kontrol edin',
    'check battery connections': 'ak√º baƒülantƒ±larƒ±nƒ± kontrol edin',
    'Clean air intake regularly': 'Hava giri≈üini d√ºzenli temizleyin',
    'clean air intake regularly': 'hava giri≈üini d√ºzenli temizleyin',
    'Inspect belts and hoses': 'Kayƒ±≈ü ve hortumlarƒ± kontrol edin',
    'inspect belts and hoses': 'kayƒ±≈ü ve hortumlarƒ± kontrol edin',
    'Monitor engine temperature': 'Motor sƒ±caklƒ±ƒüƒ±nƒ± takip edin',
    'monitor engine temperature': 'motor sƒ±caklƒ±ƒüƒ±nƒ± takip edin',
    'Keep fuel tank clean': 'Yakƒ±t deposunu temiz tutun',
    'keep fuel tank clean': 'yakƒ±t deposunu temiz tutun',
    'Regular diagnostic scans': 'D√ºzenli arƒ±za tespiti taramasƒ±',
    'regular diagnostic scans': 'd√ºzenli arƒ±za tespiti taramasƒ±',
    'Professional inspection recommended': 'Profesyonel kontrol √∂nerilir',
    'professional inspection recommended': 'profesyonel kontrol √∂nerilir',
    'Annual safety inspection': 'Yƒ±llƒ±k g√ºvenlik kontrol√º',
    'annual safety inspection': 'yƒ±llƒ±k g√ºvenlik kontrol√º',
    'Keep service records': 'Servis kayƒ±tlarƒ±nƒ± saklayƒ±n',
    'keep service records': 'servis kayƒ±tlarƒ±nƒ± saklayƒ±n',
    'Use authorized service centers': 'Yetkili servisleri kullanƒ±n',
    'use authorized service centers': 'yetkili servisleri kullanƒ±n',
    
    // Additional common automotive terms
    'stalling': 'motor durmasƒ±',
    'starter part': 'mar≈ü par√ßasƒ±',
    'faulty': 'arƒ±zalƒ±',
    'potential': 'potansiyel',
    'due to': 'nedeniyle',
    'issue': 'sorun',
    'problem': 'sorun',
    'noise': 'g√ºr√ºlt√º',
    'glitches': 'arƒ±zalar',
    'glitch': 'arƒ±za',
    'failures': 'arƒ±zalar',
    'failure': 'arƒ±za',
    'wear': 'a≈üƒ±nma',
    'consumption': 't√ºketim',
    'mount': 'takoz',
    'sensor': 'sens√∂r',
    'wiring': 'kablo',
    'module': 'mod√ºl',
    'pump': 'pompa',
    'buildup': 'birikim',
    'carbon': 'karbon',
    'components': 'par√ßalar',
    'component': 'par√ßa',
    'cooling': 'soƒüutma',
    'plastic': 'plastik',
    'inflator': '≈üi≈üirici',
    'pretensioner': '√∂n gergi',
    'handle': 'kol',
    'steering wheel': 'direksiyon simidi',
    'software update': 'yazƒ±lƒ±m g√ºncellemesi',
    'annually': 'yƒ±lda bir',
    'monthly': 'aylƒ±k',
    'premium fuel': 'premium yakƒ±t',
    'prevent': '√∂nlemek',
    'miles': 'mil',
    'check': 'kontrol edin',
    'replace': 'deƒüi≈ütirin',
    'service': 'bakƒ±m yapƒ±n',
    'every': 'her',
    'months': 'ay',
    'system': 'sistem',
    'coolant': 'soƒüutma suyu',
    'transmission fluid': '≈üanzƒ±man yaƒüƒ±',
    'brake pads': 'fren balata',
    'discs': 'diskler',
    'air filter': 'hava filtresi',
    'timing belt': 'triger kayƒ±≈üƒ±',
    'spark plugs': 'bujiler',
    'cabin filter': 'kabin filtresi',
    'suspension': 's√ºspansiyon',
    
    // Technical automotive terms - Engine
    'TwinPower Turbo': 'TwinPower Turbo',
    'Turbo': 'Turbo',
    'turbo': 'turbo',
    'Turbocharged': 'Turbolu',
    'turbocharged': 'turbolu',
    'Direct Injection': 'Direkt Enjeksiyon',
    'direct injection': 'direkt enjeksiyon',
    'Multi Air': 'Multi Air',
    'MultiAir': 'MultiAir',
    'JTDM': 'JTDM',
    'Premium Gasoline': 'Premium Benzin',
    'premium gasoline': 'premium benzin',
    'Gasoline': 'Benzin',
    'gasoline': 'benzin',
    'Petrol': 'Benzin',
    'petrol': 'benzin',
    'Diesel': 'Dizel',
    'diesel': 'dizel',
    'Hybrid': 'Hibrit',
    'hybrid': 'hibrit',
    'Electric': 'Elektrikli',
    'electric': 'elektrikli',
    'hp': 'hp',
    'HP': 'HP',
    'Nm': 'Nm',
    'rpm': 'rpm',
    'RPM': 'RPM',
    
    // Transmission terms
    '8-Speed Automatic': '8 Vitesli Otomatik',
    '8-speed automatic': '8 vitesli otomatik',
    '6-Speed Manual': '6 Vitesli Manuel',
    '6-speed manual': '6 vitesli manuel',
    '5-Speed Manual': '5 Vitesli Manuel',
    '5-speed manual': '5 vitesli manuel',
    'Manual Transmission': 'Manuel ≈ûanzƒ±man',
    'manual transmission': 'manuel ≈üanzƒ±man',
    'Automatic Transmission': 'Otomatik ≈ûanzƒ±man',
    'automatic transmission': 'otomatik ≈üanzƒ±man',
    'Automatic': 'Otomatik',
    'automatic': 'otomatik',
    'Manual': 'Manuel',
    'manual': 'manuel',
    'CVT': 'CVT',
    'DSG': 'DSG',
    'xDrive': 'xDrive',
    'AWD': 'AWD',
    'FWD': '√ñnden √áeki≈ü',
    'RWD': 'Arkadan ƒ∞ti≈ü',
    
    // Performance terms
    '0-60 mph': '0-100 km/s',
    '0-100 km/h': '0-100 km/s',
    'mph': 'km/s',
    'km/h': 'km/s',
    'seconds': 'saniye',
    'second': 'saniye',
    'electronically limited': 'elektronik sƒ±nƒ±rlƒ±',
    'top speed': 'maksimum hƒ±z',
    'maximum speed': 'maksimum hƒ±z',
    'acceleration': 'hƒ±zlanma',
    'performance': 'performans',
    
    // Fuel economy terms
    'city': '≈üehir i√ßi',
    'highway': '≈üehir dƒ±≈üƒ±',
    'combined': 'ortalama',
    'mpg': 'km/lt',
    'MPG': 'km/lt',
    'L/100km': 'L/100km',
    'fuel economy': 'yakƒ±t t√ºketimi',
    'fuel consumption': 'yakƒ±t t√ºketimi',
    'efficiency': 'verimlilik',
    
    // Body types
    'Sedan': 'Sedan',
    'sedan': 'sedan',
    'Hatchback': 'Hatchback',
    'hatchback': 'hatchback',
    'SUV': 'SUV',
    'suv': 'SUV',
    'Coupe': 'Coupe',
    'coupe': 'coupe',
    'Convertible': 'Cabrio',
    'convertible': 'cabrio',
    'Wagon': 'Station Wagon',
    'wagon': 'station wagon',
    'Crossover': 'Crossover',
    'crossover': 'crossover',
    'Compact': 'Kompakt',
    'compact': 'kompakt',
    'Executive': '√úst Segment',
    'executive': '√ºst segment',
    'Luxury': 'L√ºks',
    'luxury': 'l√ºks',
    'Sport': 'Spor',
    'sport': 'spor',
    'Sports': 'Spor',
    'sports': 'spor',
    
    // Generation terms
    'Generation': 'Nesil',
    'generation': 'nesil',
    'First': 'Birinci',
    'first': 'birinci',
    'Second': 'ƒ∞kinci',
    'second': 'ikinci',
    'Third': '√ú√ß√ºnc√º',
    'third': '√º√ß√ºnc√º',
    'Fourth': 'D√∂rd√ºnc√º',
    'fourth': 'd√∂rd√ºnc√º',
    'Fifth': 'Be≈üinci',
    'fifth': 'be≈üinci',
    'Sixth': 'Altƒ±ncƒ±',
    'sixth': 'altƒ±ncƒ±',
    'Seventh': 'Yedinci',
    'seventh': 'yedinci',
    'Eighth': 'Sekizinci',
    'eighth': 'sekizinci',
    
    // Years and time
    'years': 'yƒ±l',
    'year': 'yƒ±l',
    'old': 'ya≈üƒ±nda',
    'age': 'ya≈ü',
    'range': 'aralƒ±ƒüƒ±',
    'between': 'arasƒ±nda',
    'from': 'den',
    'to': 'e',
    'and': 've',
    
    // Common Problems
    'Engine problems': 'Motor sorunlarƒ±',
    'Transmission issues': '≈ûanzƒ±man sorunlarƒ±',
    'Electrical problems': 'Elektrik sorunlarƒ±',
    'Brake issues': 'Fren sorunlarƒ±',
    'Suspension problems': 'S√ºspansiyon sorunlarƒ±',
    'Air conditioning problems': 'Klima sorunlarƒ±',
    'Paint issues': 'Boya sorunlarƒ±',
    'Interior wear': 'ƒ∞√ß mekan a≈üƒ±nmasƒ±',
    'Rust problems': 'Pas sorunlarƒ±',
    'Fuel system issues': 'Yakƒ±t sistemi sorunlarƒ±',
    'Timing chain issues': 'Timing zinciri sorunlarƒ±',
    'Water pump failures': 'Su pompasƒ± arƒ±zalarƒ±',
    'Carbon buildup': 'Karbon birikimi',
    'Plastic components': 'Plastik par√ßalar',
    
    // Maintenance Tips
    'Regular oil changes': 'D√ºzenli yaƒü deƒüi≈üimi',
    'Check fluids': 'Sƒ±vƒ±larƒ± kontrol edin',
    'Tire rotation': 'Lastik rotasyonu',
    'Brake inspection': 'Fren kontrol√º',
    'Battery maintenance': 'Ak√º bakƒ±mƒ±',
    'Air filter replacement': 'Hava filtresi deƒüi≈üimi',
    'Coolant system check': 'Soƒüutma sistemi kontrol√º',
    'Spark plug replacement': 'Buji deƒüi≈üimi',
    'Transmission service': '≈ûanzƒ±man servisi',
    'Use premium fuel': 'Premium yakƒ±t kullanƒ±n',
    'Software updates': 'Yazƒ±lƒ±m g√ºncellemeleri',
    'Annual inspection': 'Yƒ±llƒ±k kontrol',
    'Seasonal maintenance': 'Mevsimsel bakƒ±m',
    
    // Additional common terms
    'entertainment': 'eƒülence',
    'system': 'sistem',
    'infotainment': 'bilgi-eƒülence',
    'touchscreen': 'dokunmatik ekran',
    'display': 'ekran',
    'wheels': 'jantlar',
    'alloy': 'ala≈üƒ±m',
    'steel': '√ßelik',
    'users': 'kullanƒ±cƒ±lar',
    'professionals': 'profesyoneller',
    'commuting': 'i≈üe gidi≈ü',
    'driving': 's√ºr√º≈ü',
    'urban': '≈üehirli',
    'city': '≈üehir',
    'young': 'gen√ß',
    'daily': 'g√ºnl√ºk',
    'weekend': 'hafta sonu',
    'business': 'i≈ü',
    'family': 'aile',
    'luxury': 'l√ºks',
    'premium': 'premium',
    'standard': 'standart',
    'automatic': 'otomatik',
    'manual': 'manuel',
    'electric': 'elektrikli',
    'electronic': 'elektronik',
    'digital': 'dijital',
    'wireless': 'kablosuz',
    'heated': 'ƒ±sƒ±tmalƒ±',
    'leather': 'deri',
    'fabric': 'kuma≈ü',
    'sport': 'spor',
    'comfort': 'konfor',
    'safety': 'g√ºvenlik',
    'security': 'g√ºvenlik',
    'theft': 'hƒ±rsƒ±zlƒ±k',
    'anti': 'anti',
    'control': 'kontrol',
    'assist': 'asistan',
    'monitoring': 'izleme',
    'sensor': 'sens√∂r',
    'sensors': 'sens√∂rler',
    'camera': 'kamera',
    'audio': 'ses',
    'sound': 'ses',
    'navigation': 'navigasyon',
    'GPS': 'GPS',
    'bluetooth': 'bluetooth',
    'USB': 'USB',
    'charging': '≈üarj',
    'power': 'g√º√ß',
    'steering': 'direksiyon',
    'seats': 'koltuklar',
    'seat': 'koltuk',
    'windows': 'camlar',
    'window': 'cam',
    'doors': 'kapƒ±lar',
    'door': 'kapƒ±',
    'lights': 'farlar',
    'light': 'far',
    'headlights': 'farlar',
    'LED': 'LED',
    'climate': 'klima',
    'air': 'hava',
    'conditioning': 'klimasƒ±',
    
    // More specific automotive terms
    'drivers': 's√ºr√ºc√ºler',
    'driver': 's√ºr√ºc√º',
    'families': 'aileler',
    'small': 'k√º√ß√ºk',
    'large': 'b√ºy√ºk',
    'trips': 'yolculuklar',
    'trip': 'yolculuk',
    'short': 'kƒ±sa',
    'long': 'uzun',
    'locking': 'kilit',
    'lock': 'kilit',
    'central': 'merkezi',
    'manual': 'manuel',
    'electric': 'elektrikli',
    'front': '√∂n',
    'rear': 'arka',
    'side': 'yan',
    'left': 'sol',
    'right': 'saƒü',
    'automatic': 'otomatik',
    'powered': 'elektrikli',
    'hydraulic': 'hidrolik',
    'mechanical': 'mekanik',
    'digital': 'dijital',
    'analog': 'analog',
    'basic': 'temel',
    'advanced': 'geli≈ümi≈ü',
    'simple': 'basit',
    'complex': 'karma≈üƒ±k',
    'modern': 'modern',
    'classic': 'klasik',
    'new': 'yeni',
    'old': 'eski',
    'fresh': 'taze',
    'used': 'kullanƒ±lmƒ±≈ü',
    'owner': 'sahip',
    'owners': 'sahipler',
    'buyer': 'alƒ±cƒ±',
    'buyers': 'alƒ±cƒ±lar',
    'seller': 'satƒ±cƒ±',
    'sellers': 'satƒ±cƒ±lar'
  };

  // Translate arrays
  const translateArray = (arr) => {
    if (!Array.isArray(arr)) {
      // If it's a string, split it by comma and create array
      if (typeof arr === 'string') {
        return arr.split(',').map(item => translateString(item.trim()));
      }
      return arr;
    }
    
    // Make sure we return an array, not a string
    return arr.map(item => {
      if (typeof item === 'string') {
        return translateString(item);
      }
      return item;
    });
  };

  // Translate string values - INTELLIGENT UNIVERSAL SYSTEM
  const translateString = (str) => {
    if (typeof str !== 'string') return str;
    
    let result = str.trim();
    
    // Step 1: Try exact match first (for perfect translations)
    for (const [english, turkish] of Object.entries(translations)) {
      if (result.toLowerCase() === english.toLowerCase()) {
        return turkish;
      }
    }
    
    // Step 2: Intelligent phrase replacement (longest phrases first)
    const sortedTranslations = Object.entries(translations)
      .sort((a, b) => b[0].length - a[0].length);
    
    for (const [english, turkish] of sortedTranslations) {
      // Only replace meaningful phrases (3+ chars) with word boundaries
      if (english.length >= 3) {
        const regex = new RegExp(`\\b${english.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
        result = result.replace(regex, turkish);
      }
    }
    
    // Step 3: Word-by-word fallback for remaining English words
    const words = result.split(/\s+/);
    const translatedWords = words.map(word => {
      // Clean word (remove punctuation for matching)
      const cleanWord = word.replace(/[.,;:!?()[\]{}]/g, '').toLowerCase();
      
      // Try to find translation for the clean word
      for (const [english, turkish] of Object.entries(translations)) {
        if (english.toLowerCase() === cleanWord) {
          // Preserve original punctuation
          return word.replace(new RegExp(cleanWord, 'gi'), turkish);
        }
      }
      
      return word; // Keep original if no translation found
    });
    
    return translatedWords.join(' ');
  };



  // Ensure arrays are actually arrays - improved for various formats
  const ensureArray = (field) => {
    if (Array.isArray(field)) {
      return field;
    }
    
    if (typeof field === 'string') {
      // Remove brackets if present: ["item1", "item2"] or ['item1', 'item2']
      let cleanString = field.replace(/^\[|\]$/g, '');
      
      // If contains quotes, split by quote patterns
      if (cleanString.includes('"') || cleanString.includes("'")) {
        // Extract quoted items: "item1", "item2", "item3"
        const matches = cleanString.match(/"([^"]+)"|'([^']+)'/g);
        if (matches) {
          return matches.map(match => match.replace(/['"]/g, ''));
        }
      }
      
      // Fallback: split by comma and clean
      return cleanString.split(',').map(item => item.trim()).filter(item => item.length > 0);
    }
    
    return [];
  };

  // Return data as-is (already in correct language from OpenAI)
  return data;
}; 